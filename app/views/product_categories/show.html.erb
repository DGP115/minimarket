<turbo-frame id="categorytree_productlist_toggle">
  <div class="mt-2">
    <%#  Display breadcrumbs of the category hierarchy for the current product_category %>
    <% @product_category.ancestors.each do |ancestor| %>
      <%= link_to ancestor.name, product_category_path(ancestor),
                                data: {turbo_frame: "categorytree_productlist_toggle",
                                       turbo_action: "advance" },
                                 class: "hover:underline text-blue-600" %> 
      <span class="mx-1"><%=render_icon("forward", classes:"w-4 h-4 inline-block align-middle stroke-blue-400")%></span>
    <% end %>
  </div>

  <%# For Admin users, there is a right-click pop-up menu for a category %>
  <% if user_signed_in? && current_user.admin? %>
    <div class="inline-block"
         data-controller="context-menu"
         data-action="contextmenu->context-menu#open"
         data-context-menu-target="anchor">  <!-- Attach context-menu controller to parent div -->
        <!--Product Category context menu -->
        <!--Note: meaning of data-action phrase: -->
        <!--      contextmenu is the DOM event name for the browser's right-click event -->
        <!--       So, we are telling it to launch the context-menu controller's contextmenu method-->
        <!--NOTE:  By attaching the controller and action to the link, instead of the parent div, -->
        <!--       the menu is active only when hovering on the link text vs the whole div -->
        <div class="px-2 py-1 text-lg font-semibold rounded-md cursor-pointer hover:bg-blue-200"> 
          <%= @product_category.name %>
        </div>

        <%= render partial: "shared/category_context_menu", locals: { record: @product_category } %>

    </div>
  <% else %>
    <%# Don't show cursor change or context menu for non-admin users %>
    <div class="px-2 py-1 text-lg font-semibold rounded-md"> 
      <%= @product_category.name %>
    </div>
  <% end %>


  <% if !@product_category.description.nil? &&  !@product_category.description.blank? %>
    <div class="w-full p-2 mt-2 ml-10 text-base font-light border rounded-md max-w-2/3 bg-stone-100">
      <%= @product_category.description %>
    </div>
  <% end %>

  <% if @product_categories.any? %>
    <%# Render the sub-categories in a grid layout %>
    <ul class="pl-8 mt-4">
      <%# Pass instance variable to partial as a local. %>
      <%# Because recursion is used within the partial to display sub-categories, %>
      <%# the partial loops through a local variable, which is reset during the 
      <%# hierarchical recursion. %>
      <%# Otherwise an endless loop results because @product_categories doesn't change  %>
      
      <%= render partial: "product_categories/category_tree", 
                 locals: { product_categories: @product_categories, 
                           product_category: @product_category } %>
      
    </ul>
  <% end %>

  <% if @products.any? %>
    <%= render partial: "products/index", locals: { products: @products, product_category: @product_category } %>
  <% end %>
</turbo-frame>


