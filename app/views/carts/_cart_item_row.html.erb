<%# locals: { item: item, index: index, editable: editable, f: item_fields %>
<!--NOTE: Stimulus controller cart-contents was "attached" in the edit view, which begets this partial -->
<!--NOTE: data-price="<%= item.product.price %> defines a custom HTML data attribute named data-price on the rowâ€™s <div>.
          yielding something like: <div id="cart_item_245" class="contents" data-price="63.5">
          When the Stimulus controller runs, it can access that value through the dataset API in JavaScript -->
<div id="cart_item_<%= item.id %>" 
     class="contents"
     data-price="<%= item.product.price %>">

  <!-- Item index -->  
  <div class="px-2 text-xs font-normal text-center md:text-sm"><%= index + 1 %></div>

  <!-- Product Title --> 
  <%= link_to item.product.title, 
              product_path(item.product_id), 
              class: "px-4 font-normal text-xs md:text-sm text-blue-600 hover:font-semibold hover:cursor-pointer" %>

  <% if editable && local_assigns[:f] %>
    <!-- cart_item delete button --> 
    <div class="flex justify-center">
      
      <!-- hidden destroy flag per cart_item.  Set via stimulus.  Handled via cart.rb and carts_controller  -->
      <%= f.check_box :_destroy, class: "hidden destroy-flag" %>

      <button type="button" 
              class="p-0 bg-transparent border-none"
              data-action="click->cart-contents#deleteItem"
              data-item-id="<%= item.id %>"
              title="Delete item">
        <%= render_icon("trashcan", classes: "w-4 h-4 text-sm hover:cursor-pointer hover:scale-110") %>
    </div>

    <!-- Quantity cell -->
    <!-- NOTE:  cart_contents_target: "rowQuantity" tells stimulus controller cart-contents that 
                this is a quantity and whould be watched for changes -->
    <div class="px-3">
      <%= f.number_field :quantity,
                          value: item.quantity,
                          min: 0,
                          class: "w-16 text-center text-xs md:text-sm bg-green-100 border rounded px-1 py-0.5",
                          data: { item_id: item.id, cart_contents_target: "rowQuantity" } %>
    </div>
  <% else %>

    <!--non-edit mode.  &nbsp; is a non-breaking space to account for trachcan button not being displayed-->
    <div class="px-2 text-center">&nbsp;</div>
    <div class="px-2 text-xs font-normal text-center md:text-sm"><%= item.quantity %></div>

  <% end %>

  <!-- Unit price -->
  <div class="px-2 text-xs font-normal text-right md:text-sm">
    <%= number_to_currency(item.product.price, precision: 2, unit: "$", delimiter: ",") %>
  </div>

  <!-- Purchase (price * qty) -->
  <!-- NOTE:  data-cart-contents-target: "purchaseCell" tells stimulus controller cart-contents that 
              this is the purchase cell that should be updated when quantity changes -->
  <div class="px-2 text-xs font-normal text-right md:text-sm"
       data-cart-contents-target="purchaseCell">
    <%= number_to_currency(item.product.price * item.quantity, 
                           precision: 2, 
                           unit: "$", 
                           delimiter: ",") %>
  </div>

</div>