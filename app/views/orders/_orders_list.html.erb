<div class="w-full pl-4 md:w-5/6"> 

  <h1 class="mb-4 text-base font-semibold">
    <em><%= current_user&.name&.titlecase %></em>:  Your order history:
  </h1>

  <% if orders.any? %>
    <div class="overflow-x-auto">
      <table class="hidden min-w-full border divide-y rounded-md md:table md:table-auto border-stone-400 divide-stone-300 bg-indigo-50">
        <thead class="bg-indigo-100">
          <tr class="text-sm font-semibold text-center">
            <!-- Header Row -->
            <th class="px-2 py-2">Index</th>
            <th class="px-2 py-2 text-blue-600"><%= sort_link(query, :id, "Order Number") %></th>
            <th class="px-2 py-2 text-blue-600"><%= sort_link(query, :created_at, "Created") %></th>
            <th class="px-2 py-2 text-blue-600"><%= sort_link(query, :status, "Status") %></th>
            <th class="px-2 py-2 text-blue-600"><%= sort_link(query, :status_changed_at, "Status changed...") %></th>
            <th class="px-2 py-2 text-blue-600"><%= sort_link(query, :total_amount, "Total") %></th>
            <th class="px-2 py-2">Actions</th>
          </tr>
        </thead>

        <tbody class="text-sm font-normal divide-y divide-stone-200">

          <% orders.each_with_index do |order, index| %>
            <tr class="text-center">
              <!-- Data Rows -->
              <td class="px-2"><%= num_orders - index %></td>
              <td class="px-2"><%= order.id %></td>
              <td class="px-2"><%= order.created_at.strftime("%e-%b-%Y:%l:%M:%S %P") %></td>
              <td class="px-2"><%= order.status %></td>
              <td class="px-2"><%= order.status_changed_at&.strftime("%e-%b-%Y:%l:%M:%S %P") %></td>
              <td class="px-2"><%= number_to_currency(order.total_amount,
                                                           precision: 2,
                                                           unit: "$",
                                                           delimiter: ",") %></td>
              <td class="px-2">
                <div class="flex flex-col justify-center gap-2 sm:flex-row">
                  <%= link_to(order_path(order))  do %>
                      <span>
                        <%= render_icon("show_details", classes: "pt-1 mt-1 mb-1 h-6 w-6 rounded-md stroke-blue-800 hover:stroke-green-500 hover:scale-110") %>
                      </span>
                  <% end %>
                  <%= button_to(order_path(order),
                                method: :delete, 
                                class: "", 
                                data: { turbo_confirm: "Are you sure?" }) do %>
                    <span>
                      <%= render_icon("trashcan", classes: "pt-1 mt-1 mb-1 h-6 w-6 rounded-md cursor-pointer hover:scale-110 hover:stroke-red-700") %>
                    </span>
                  <% end %>

                </div>
              </td>
            </tr>

          <% end %>
        </tbody>
      </table>

      <!-- Mobile stacked view -->
      <div class="space-y-4 md:hidden">

        <% orders.each_with_index do |order, index| %>
          <div class="p-4 border rounded-md shadow-sm border-stone-300 bg-indigo-50">
            <div class="flex justify-between mb-2 text-sm font-semibold">
              <span>Index:</span>
              <span><%= num_orders - index %></span>
            </div>
            <div class="flex justify-between text-sm">
              <span>Order #:</span>
              <span><%= order.id %></span>
            </div>
            <div class="flex justify-between text-sm">
              <span>Created:</span>
              <span><%= order.created_at.strftime("%e-%b-%Y %l:%M %P") %></span>
            </div>
            <div class="flex justify-between text-sm">
              <span>Status:</span>
              <span><%= order.status %></span>
            </div>
            <div class="flex justify-between text-sm">
              <span>Status Changed:</span>
              <span><%= order&.status_changed_at&.strftime("%e-%b-%Y %l:%M %P") %></span>
            </div>
            <div class="flex justify-between text-sm font-medium">
              <span>Total:</span>
              <span><%= number_to_currency(order.total_amount, precision: 2, unit: "$", delimiter: ",") %></span>
            </div>
 
            <div class="flex flex-row justify-center w-48 gap-2 mx-auto mt-3 border rounded-sm gap-x-6 border-stone-400">
              <%= link_to(order_path(order)) do %>
                <span>
                  <%= render_icon("show_details", classes: "pt-1 mt-1 mb-1 h-6 w-6 stroke-blue-800 rounded-md hover:stroke-green-500") %>
                </span>
              <% end %>
              <%= button_to(order_path(order),
                            method: :delete, 
                            data: { turbo_confirm: "Are you sure?" }) do %>
                <span>
                  <%= render_icon("trashcan", classes: "pt-1 mt-1 mb-1 h-6 w-6 rounded-md cursor-pointer hover:scale-110 hover:stroke-red-700") %>
                </span>
              <% end %>
            </div>

          </div>
        <% end %>
      </div>

    </div>

  <% else %>
    <p class="my-10 text-center">No orders found.</p>
  <% end %>

</div>
