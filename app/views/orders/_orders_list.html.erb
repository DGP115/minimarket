<div class="md:w-5/6 w-full pl-4"> 

  <h1 class="font-semibold text-base mb-4">
    <em><%= current_user&.name&.titlecase %></em>:  Your order history:
  </h1>

  <% if orders.any? %>
    <div class="overflow-x-auto">
      <table class="hidden md:table md:table-auto min-w-full border border-stone-400 divide-y divide-stone-300 bg-indigo-50 rounded-md">
        <thead class="bg-indigo-100">
          <tr class="text-sm font-semibold text-center">
            <!-- Header Row -->
            <th class="px-2 py-2">Index</th>
            <th class="px-2 py-2"><%= sort_link(query, :id, "Order Number") %></th>
            <th class="px-2 py-2"><%= sort_link(query, :created_at, "Created") %></th>
            <th class="px-2 py-2"><%= sort_link(query, :status, "Status") %></th>
            <th class="px-2 py-2"><%= sort_link(query, :status_changed_at, "Status changed...") %></th>
            <th class="px-2 py-2"><%= sort_link(query, :total_amount, "Total") %></th>
          </tr>
        </thead>

        <tbody class="text-sm font-normal divide-y divide-stone-200">

          <% orders.each_with_index do |order, index| %>
            <tr class="text-center">
              <!-- Data Rows -->
              <td class="px-2 py-1"><%= num_orders - index %></td>
              <td class="px-2 py-1"><%= order.id %></td>
              <td class="px-2 py-1"><%= order.created_at.strftime("%e-%b-%Y:%l:%M:%S %P") %></td>
              <td class="px-2 py-1"><%= order.status %></td>
              <td class="px-2 py-1"><%= order.status_changed_at&.strftime("%e-%b-%Y:%l:%M:%S %P") %></td>
              <td class="px-2 py-1"><%= number_to_currency(order.total_amount,
                                                           precision: 2,
                                                           unit: "$",
                                                           delimiter: ",") %></td>
              <td class="px-2 py-2">
                <div class="flex flex-col sm:flex-row justify-center gap-2">
                  <%= link_to(order_path(order),
                      class: "rounded-md hover:bg-indigo-400")  do %>
                      <span>
                        <%= render_icon("show_details", classes: "pt-1 mt-1 mb-1 h-6 w-6") %>
                      </span>
                  <% end %>
                  <%= link_to(edit_order_path(order),
                              class:"rounded-md hover:bg-violet-400") do %>
                    <span > 
                      <%= render_icon("edit", classes: "pt-1 mt-1 mb-1 h-6 w-6") %>
                    </span>
                  <% end %>
                  <%= button_to(order_path(order),
                                method: :delete, 
                                class: "rounded-md hover:bg-red-400", 
                                data: { turbo_confirm: "Are you sure?" }) do %>
                    <span>
                      <%= render_icon("trashcan", classes: "pt-1 mt-1 mb-1 h-6 w-6") %>
                    </span>
                  <% end %>

                </div>
              </td>
            </tr>

          <% end %>
        </tbody>
      </table>

      <!-- Mobile stacked view -->
      <div class="space-y-4 md:hidden">

        <% orders.each_with_index do |order, index| %>
          <div class="border border-stone-300 rounded-md p-4 bg-indigo-50 shadow-sm">
            <div class="flex justify-between mb-2 text-sm font-semibold">
              <span>Index:</span>
              <span><%= num_orders - index %></span>
            </div>0
            <div class="flex justify-between text-sm">
              <span>Order #:</span>
              <span><%= order.id %></span>
            </div>
            <div class="flex justify-between text-sm">
              <span>Created:</span>
              <span><%= order.created_at.strftime("%e-%b-%Y %l:%M %P") %></span>
            </div>
            <div class="flex justify-between text-sm">
              <span>Status:</span>
              <span><%= order.status %></span>
            </div>
            <div class="flex justify-between text-sm">
              <span>Status Changed:</span>
              <span><%= order&.status_changed_at&.strftime("%e-%b-%Y %l:%M %P") %></span>
            </div>
            <div class="flex justify-between text-sm font-medium">
              <span>Total:</span>
              <span><%= number_to_currency(order.total_amount, precision: 2, unit: "$", delimiter: ",") %></span>
            </div>
            <div class="mt-3 flex flex-row justify-center gap-x-4 sm:flex-row gap-2">
              <%= link_to(order_path(order),
                          class:"rounded-md hover:bg-indigo-400") do %>
                <span>
                  <%= render_icon("show_details", classes: "pt-1 mt-1 mb-1 h-6 w-6") %>
                </span>
              <% end %>
              <%= link_to(edit_order_path(order), 
                          class:"rounded-md hover:bg-violet-400") do %>
                <span>
                  <%= render_icon("edit", classes: "pt-1 mt-1 mb-1 h-6 w-6") %>
                </span>
              <% end %>
              <%= button_to(order_path(order),
                            method: :delete, 
                            class: "rounded-md hover:bg-red-400", 
                            data: { turbo_confirm: "Are you sure?" }) do %>
                <span>
                  <%= render_icon("trashcan", classes: "pt-1 mt-1 mb-1 h-6 w-6") %>
                </span>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>

    </div>

  <% else %>
    <p class="text-center my-10">No orders found.</p>
  <% end %>

</div>
